server {
	server_name alkurlevsky.ru www.alkurlevsky.ru;
	charset off;
	index index.php index.html;
	disable_symlinks if_not_owner from=$root_path;
	include /etc/nginx/vhosts-includes/*.conf;
	include /etc/nginx/vhosts-resources/alkurlevsky.ru/*.conf;
	access_log /var/www/httpd-logs/alkurlevsky.ru.access.log;
	error_log /var/www/httpd-logs/alkurlevsky.ru.error.log notice;
	ssi on;
	set $root_path /var/www/www-root/data/www/alkurlevsky.ru;
	root $root_path;
	gzip on;
	gzip_comp_level 5;
	gzip_disable "msie6";
	gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript image/svg+xml;
	location / {
		location ~* ^.+\.(jpg|jpeg|gif|png|svg|js|css|mp3|ogg|mpe?g|avi|zip|gz|bz2?|rar|swf|webp|woff|woff2)$ {
			expires 24h;
		}
	}
	return 301 https://$host:443$request_uri;
	listen 82.202.173.73:80 default_server;
}
upstream superset_app {
	server host.docker.internal:8088;
	keepalive 100;
}

server {
	server_name alkurlevsky.ru www.alkurlevsky.ru;
	ssl_certificate "/var/www/httpd-cert/www-root/alkurlevsky.ru_le2.crtca";
	ssl_certificate_key "/var/www/httpd-cert/www-root/alkurlevsky.ru_le2.key";
	ssl_ciphers EECDH:+AES256:-3DES:RSA+AES:!NULL:!RC4;
	ssl_prefer_server_ciphers on;
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
	ssl_dhparam /etc/ssl/certs/dhparam4096.pem;
	charset off;
	index index.php index.html;
	disable_symlinks if_not_owner from=$root_path;
	include /etc/nginx/vhosts-includes/*.conf;
	include /etc/nginx/vhosts-resources/alkurlevsky.ru/*.conf;
	access_log /var/www/httpd-logs/alkurlevsky.ru.access.log;
	error_log /var/www/httpd-logs/alkurlevsky.ru.error.log notice;
	ssi on;
	set $root_path /var/www/www-root/data/www/alkurlevsky.ru;
	root $root_path;
	gzip on;
	gzip_comp_level 5;
	gzip_disable "msie6";
	gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript image/svg+xml;
	location / {
		proxy_pass http://127.0.0.1:8088;
		proxy_set_header    Host                $host;
		proxy_set_header    X-Real-IP           $remote_addr;
		proxy_set_header    X-Forwarded-For     $remote_addr;
		proxy_set_header    X-Forwarded-Host    $host;
		proxy_set_header    X-Forwarded-Proto   $scheme;
		proxy_http_version 1.1;
		port_in_redirect off;
		proxy_connect_timeout 300;
		# location ~* ^.+\.(jpg|jpeg|gif|png|svg|js|css|mp3|ogg|mpe?g|avi|zip|gz|bz2?|rar|swf|webp|woff|woff2)$ {
		# 	expires 24h;
		# }
	}
	location /airflow/ {
		proxy_pass http://127.0.0.1:8081;
		proxy_set_header Host $http_host;
		proxy_redirect off;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
	}

	location /auth {
		proxy_pass http://127.0.0.1:8086/auth;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header X-Forwarded-Proto $scheme;
	}
	# location /bi {
	# 	proxy_pass http://localhost:8088;
	# 	proxy_set_header    Host                $host;
	# 	proxy_set_header    X-Real-IP           $remote_addr;
	# 	proxy_set_header    X-Forwarded-For     $remote_addr;
	# 	proxy_set_header    X-Forwarded-Host    $host;
	# 	proxy_set_header    X-Forwarded-Proto   $scheme;
	# 	proxy_http_version 1.1;
	# 	port_in_redirect off;
	# 	proxy_connect_timeout 300;
	# }
	listen 82.202.173.73:443 ssl default_server;
}
